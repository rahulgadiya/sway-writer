$& = override

# ═══════════════════════════════════════
# OPACITY VARIABLES
# ═══════════════════════════════════════

$opacity_focus = 0.95    # Primary work apps
$opacity_work = 0.85     # Secondary tools
$opacity_utility = 0.75  # System utilities
$opacity_social = 0.70   # Communication/media

# ═══════════════════════════════════════
# SYSTEM BEHAVIOR
# ═══════════════════════════════════════

# Prevent screen lock during media
windowrule = idleinhibit fullscreen, class:^(.*celluloid.*|.*mpv.*|.*vlc.*|.*[Ss]potify.*)$
windowrule = idleinhibit fullscreen, class:^(.*LibreWolf.*|.*floorp.*|.*brave-browser.*|.*firefox.*|.*chromium.*|.*zen.*|.*vivaldi.*|.*qutebrowser.*)$

# Picture-in-Picture
windowrule = float, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = keepaspectratio, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = move 72% 70%, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = size 26% 26%, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrule = pin, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$

# ═══════════════════════════════════════
# OPACITY RULES
# ═══════════════════════════════════════

# Primary Work Applications
windowrule = opacity $opacity_focus $& $opacity_focus $& 1, class:^(org.gnome.TextEditor|obsidian|org.gnome.gitlab.somas.Apostrophe|org.qutebrowser.qutebrowser)$

# Development & Browsers
windowrule = opacity $opacity_work $& $opacity_work $& 1, class:^(firefox|brave-browser|kitty|code-oss|[Cc]ode|code-url-handler|cursor|zed)$

# File Management
windowrule = opacity $opacity_work $& $opacity_work $& 1, class:^(org.kde.dolphin)$
windowrule = opacity $opacity_utility $& $opacity_utility $& 1, class:^(org.kde.ark)$

# System Utilities
windowrule = opacity $opacity_utility $& $opacity_utility $& 1, class:^(nwg-look|qt5ct|qt6ct|kvantummanager|org.pulseaudio.pavucontrol|blueman-manager|nm-applet|nm-connection-editor)$

# Communication & Media
windowrule = opacity $opacity_social $& $opacity_social $& 1, class:^([Ss]potify|BeeperTexts|discord|vesktop|WebCord)$
windowrule = opacity $opacity_social $& $opacity_social $& 1, initialTitle:^(Spotify Free|Spotify Premium)$

# Security (Opaque)
windowrule = opaque, class:^(org.kde.polkit-kde-authentication-agent-1|polkit-gnome-authentication-agent-1|.*[Pp]assword.*|.*[Aa]uth.*)$

# ═══════════════════════════════════════
# FLOATING RULES
# ═══════════════════════════════════════

# Productivity Tools
windowrule = float, size 900 600, center, class:^(org.pulseaudio.pavucontrol)$
windowrule = float, size 800 500, center, class:^(blueman-manager)$
windowrule = float, size 700 400, center, class:^(nm-connection-editor)$
windowrule = float, size 600 400, center, class:^(kvantummanager|qt5ct|qt6ct)$
windowrule = float, size 500 300, center, class:^(nwg-look)$

# Calculator
windowrule = float, size 500 700, center, class:^(org.gnome.Calculator)$

# Media & Archive
windowrule = float, class:^(vlc)$
windowrule = float, size 400 300, center, class:^(org.kde.ark)$

# Authentication
windowrule = float, size 400 200, center, class:^(org.kde.polkit-kde-authentication-agent-1|polkit-gnome-authentication-agent-1)$

# File Dialogs
windowrule = float, size 900 600, center, title:^(Progress Dialog — Dolphin|Copying — Dolphin)$
windowrule = float, size 900 700, center, title:^(.*(Open|Save|Choose Files|File Upload|Select File).*)$
windowrule = float, size 800 600, center, title:^(.*(Settings|Preferences|Options|Configuration|Properties|About).*)$
windowrule = float, center, title:^(.*(Dialog|Modal|Authentication|Permission).*)$

# Browser Dialogs
windowrule = float, size 500 300, center, title:^(About Mozilla Firefox)$
windowrule = float, class:^(firefox)$, title:^(Library)$

# Terminal Utilities
windowrule = float, size 800 600, center, class:^(kitty)$, title:^(top|btop|htop)$

# ═══════════════════════════════════════
# LAYER RULES
# ═══════════════════════════════════════

layerrule = blur, rofi
layerrule = ignorezero, rofi
layerrule = blur, notifications
layerrule = ignorezero, notifications
layerrule = blur, swaync-notification-window
layerrule = ignorezero, swaync-notification-window
layerrule = blur, swaync-control-center
layerrule = ignorezero, swaync-control-center
layerrule = blur, logout_dialog

# ═══════════════════════════════════════
# WORKSPACE ASSIGNMENT
# ═══════════════════════════════════════

# Web Browsing
windowrulev2 = workspace 2 silent, class:^(org.qutebrowser.qutebrowser)$

# Terminal & Development
windowrulev2 = workspace 1 silent, class:^(foot)$
windowrulev2 = fullscreen, class:^(foot)$

# Knowledge Management
windowrulev2 = workspace 3 silent, class:^(obsidian|org.gnome.gitlab.somas.Apostrophe)$

# Communication & Media
windowrulev2 = workspace 4 silent, class:^(BeeperTexts|Beeper|discord|Discord|Slack|slack|[Ss]potify|vlc|mpv|io.freetubeapp.FreeTube|freetube)$

# ═══════════════════════════════════════
# FOCUS & PERFORMANCE
# ═══════════════════════════════════════

# Prevent focus stealing
windowrulev2 = noinitialfocus, class:^([Ss]potify|discord|Discord|BeeperTexts|Beeper|Slack|slack)$

# Immediate rendering for productivity
windowrulev2 = immediate, class:^(org.gnome.TextEditor|obsidian|org.gnome.gitlab.somas.Apostrophe|kitty|org.qutebrowser.qutebrowser)$

# Security pins
windowrulev2 = pin, class:^(org.kde.polkit-kde-authentication-agent-1)$
windowrulev2 = pin, title:^(Authentication Required|Permission Required)$
windowrulev2 = pin, class:^(org.freedesktop.impl.portal.desktop.gtk)$

# Universal portal handling
windowrulev2 = float, center, class:^([Xx]dg-desktop-portal-gtk)$
