# Only run in interactive shells
case $- in
  *i*) ;;
  *) return;;
esac

# Oh-My-Zsh installation path
export ZSH="$HOME/.oh-my-zsh"

# THEME AND APPEARANCE
ZSH_THEME="gnzh"

# Fixed emoji prompt (lightweight version)
prompt_context() {
  emojis=("⚡" "🔥" "🚀" "💎" "⭐")
  RAND_EMOJI_N=$(( $RANDOM % ${#emojis[@]} + 1))
  prompt_segment black default "${emojis[$RAND_EMOJI_N]} "
}

# ESSENTIAL ZSH OPTIONS

# History (optimized)
HISTSIZE=10000
SAVEHIST=10000
HIST_STAMPS="yyyy-mm-dd"
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE

# Navigation
setopt AUTO_CD
setopt AUTO_PUSHD
setopt PUSHD_IGNORE_DUPS

# Essential options
setopt CORRECT
setopt NO_BEEP
COMPLETION_WAITING_DOTS="true"
DISABLE_UNTRACKED_FILES_DIRTY="true"

# MINIMAL PLUGIN SET
plugins=(
  git
  zsh-autosuggestions
  zsh-syntax-highlighting
  sudo
)

# Source Oh-My-Zsh
source $ZSH/oh-my-zsh.sh

# ENVIRONMENT VARIABLES
export EDITOR='vim'
export LESS='-R -i -w -M'

# ESSENTIAL ALIASES

# File operations
alias ls='ls --color=auto'
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# Grep with colors
alias grep='grep --color=auto'

# Safety
alias rm='rm -i'
alias mv='mv -i'
alias cp='cp -i'

# System info
alias df='df -h'
alias du='du -h'
alias free='free -h'

# Git shortcuts
alias gst='git status'
alias gd='git diff'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git pull'

# Tmux
alias tm='tmux'
alias tma='tmux attach -t'

# Config shortcuts
alias zshrc='$EDITOR ~/.zshrc'
alias reload='source ~/.zshrc'

# Network
alias myip='curl -s https://ipinfo.io/ip'

# Development
alias serve='python3 -m http.server'

# ESSENTIAL FUNCTIONS

# Create and enter directory
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Extract archives
extract() {
  case "$1" in
    *.tar.gz|*.tgz) tar xzf "$1" ;;
    *.tar.bz2|*.tbz2) tar xjf "$1" ;;
    *.zip) unzip "$1" ;;
    *.rar) unrar x "$1" ;;
    *.7z) 7z x "$1" ;;
    *) echo "'$1' cannot be extracted" ;;
  esac
}

# Find files
ff() {
  find . -name "*$1*" 2>/dev/null
}

# Search history
hs() {
  history | grep "$1"
}

# LAZY LOADING (Performance Critical)

# Lazy load nvm (major performance boost)
nvm() {
  unset -f nvm
  [ -s "$HOME/.nvm/nvm.sh" ] && source "$HOME/.nvm/nvm.sh"
  nvm "$@"
}

# Lazy load pyenv
pyenv() {
  unset -f pyenv
  command -v pyenv >/dev/null 2>&1 && eval "$(pyenv init -)"
  pyenv "$@"
}

# SMART PATH ADDITIONS
[ -d "$HOME/.local/bin" ] && export PATH="$HOME/.local/bin:$PATH"
[ -d "$HOME/bin" ] && export PATH="$HOME/bin:$PATH"

# OPTIONAL STARTUP (Controlled)

# Only show system info if explicitly enabled
[ "$SHOW_FASTFETCH" = "1" ] && command -v fastfetch >/dev/null && fastfetch
